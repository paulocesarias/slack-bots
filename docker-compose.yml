services:
  slack-bots:
    build: .
    container_name: slack-bots
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - NODE_ENV=production
      - SESSION_SECRET=${SESSION_SECRET}
      - SESSION_DIR=/app/data
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - GOOGLE_CALLBACK_URL=https://slackbots.headbangtech.com/auth/google/callback
      - ALLOWED_EMAILS=${ALLOWED_EMAILS:-}
      - ALLOWED_DOMAINS=${ALLOWED_DOMAINS:-}
      - N8N_API_ENDPOINT=https://n8n.headbangtech.com/api/v1
      - N8N_API_KEY=${N8N_API_KEY}
      - N8N_TEMPLATE_WORKFLOW_ID=${N8N_TEMPLATE_WORKFLOW_ID:-JTlX2bfBh6O4HcAR}
      - SSH_HOST=${SSH_HOST:-72.61.78.57}
      - SSH_PORT=${SSH_PORT:-22}
      - SSH_USER=${SSH_USER:-root}
      - SSH_KEY_PATH=/app/ssh/id_rsa
    volumes:
      - slack-bots-data:/app/data
      - ${HOME}/.ssh/id_rsa:/app/ssh/id_rsa:ro
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://127.0.0.1:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  slack-bots-data:
